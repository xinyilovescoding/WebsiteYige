<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Test</title>
  <link rel="stylesheet" href="homepage.css">
</head>
<body>
 <div class="container">
        <h1>时至今日，你仍是我的光</h1>
<!--        <p></p>-->
        <img src="judgePhoto.jpg" alt="Small image" class="small-image">
        <button id="surpriseButton">点击我</button>

        <!-- hidden videos3 -->
        <div id="surprise" class="hidden">
            <video id="birthdayVideo" width="800" controls>
                <source src="happyBirthday.mp4" type="video/mp4">
            </video>
            <div class="controls">
                <button onclick="playVideo()">播放</button>
                <button onclick="stopVideo()">停止</button>
                <button onclick="restartVideo()">重播</button>
            </div>
            <!-- 新增按钮，用于触发25次点击事件 -->
            <button id="click14Button" class="hidden">点击25次!</button>
        </div>
    </div>

    <!-- 隐藏的音频播放部分 -->
    <audio id="audioSurprise" src="party4u.mp3"></audio>


    <div id="wishesWall">
        <h2>Wishes Wall</h2>
        <textarea id="wishInput" placeholder="Put your wishes here..."></textarea>
        <button id="submitWish">Submit Wish</button>
        <div id="wishes"></div>
    </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAnt2-oHONR0lBHlWL5hRB6p6jnDyj5SZk",
      authDomain: "birthdayyige.firebaseapp.com",
      databaseURL: "https://birthdayyige-default-rtdb.europe-west1.firebasedatabase.app/",
      projectId: "birthdayyige",
      storageBucket: "birthdayyige.firebasestorage.app",
      messagingSenderId: "956985660704",
      appId: "1:956985660704:web:6b9726c568fb47c8823345",
      measurementId: "G-N7LH6E0WHV"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const wishesRef = ref(db, "wishes");

    document.getElementById("submitWish").addEventListener("click", () => {
      const input = document.getElementById("wishInput");
      const text = input.value.trim();
      if (text) {
        push(wishesRef, { text, time: new Date().toLocaleString() });
        input.value = "";
      }
    });

    onValue(wishesRef, (snapshot) => {
      const data = snapshot.val();
      const wall = document.getElementById("wishes");
      wall.innerHTML = "";
      if (data) {
        Object.values(data).forEach(wish => {
          const div = document.createElement("div");
          div.textContent = `${wish.time} - ${wish.text}`;
          wall.appendChild(div);
        });
      }
    });

    console.log("✅ Firebase 已加载");
  </script>
  <script>
  var clickCount = 0;
  var isAudioMode = false;

  document.getElementById("surpriseButton").addEventListener("click", function() {
    var surpriseDiv = document.getElementById("surprise");
    surpriseDiv.classList.toggle("hidden");
    document.getElementById("click14Button").classList.remove("hidden");
    document.body.style.backgroundColor = "#2C2C2C";
    setInterval(changeBackgroundColor, 3000);
  });

  document.getElementById("click14Button").addEventListener("click", function() {
    clickCount++;
    if(clickCount >= 25 && !isAudioMode){
      switchToAudioMode();
      isAudioMode = true;
    }
  });

  function switchToAudioMode(){
    var video = document.getElementById("birthdayVideo");
    video.pause();
    video.classList.add("hidden");
    var audio = document.getElementById("audioSurprise");
    audio.play();
    updateControlButtons();
  }

  function updateControlButtons(){
    var controlsDiv = document.querySelector('.controls');
    controlsDiv.innerHTML = '';
    var btns = [
      {text:'播放音乐', fn:playAudio},
      {text:'暂停音乐', fn:pauseAudio},
      {text:'重新播放', fn:restartAudio},
      {text:'停止音乐', fn:stopAudio}
    ];
    btns.forEach(b=>{
      let btn=document.createElement('button');
      btn.textContent=b.text; btn.onclick=b.fn;
      controlsDiv.appendChild(btn);
    });
  }

  function playAudio(){document.getElementById("audioSurprise").play();}
  function pauseAudio(){document.getElementById("audioSurprise").pause();}
  function stopAudio(){let a=document.getElementById("audioSurprise");a.pause();a.currentTime=0;}
  function restartAudio(){let a=document.getElementById("audioSurprise");a.currentTime=0;a.play();}

  function playVideo(){let v=document.getElementById("birthdayVideo");v.muted=false;v.volume=1.0;v.play();}
  function stopVideo(){document.getElementById("birthdayVideo").pause();}
  function restartVideo(){let v=document.getElementById("birthdayVideo");v.currentTime=0;v.play();}

  function changeBackgroundColor(){
    const colors=["#2C2C2C","#3A3A3A","#4A4A4A","#5D4037","#E67E22","#D35400","#F39C12","#BF360C","#34495E","#2C3E50"];
    document.body.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
  }

  // -------------------- 愿望墙 --------------------
  document.getElementById("submitWish").addEventListener("click", function(){
    const input=document.getElementById("wishInput");
    const text=input.value.trim();
    if(!text) return;
    db.ref("wishes").push({text:text,time:new Date().toISOString()});
    input.value="";
  });

  window.onload=function(){
    db.ref("wishes").on("value", snapshot=>{
      const data=snapshot.val();
      const wall=document.getElementById("wishes");
      wall.innerHTML="";
      if(data){
        Object.entries(data).forEach(([key,wish])=>{
          const div=document.createElement("div");
          div.className="wish";
          div.innerHTML=`<div class="wish-content">${wish.text}</div>
                         <div class="wish-time">${new Date(wish.time).toLocaleString()}</div>`;
          const delBtn=document.createElement("button");
          delBtn.textContent="delete"; delBtn.style.marginLeft="10px";
          delBtn.onclick=function(){
            const code=prompt("请输入密码删除愿望：");
            if(code===adminPassword){ db.ref("wishes/"+key).remove(); alert("删除成功"); }
            else alert("密码错误");
          };
          div.appendChild(delBtn);
          wall.appendChild(div);
        });
      }
    });
  };
</script>
</body>
</html>
